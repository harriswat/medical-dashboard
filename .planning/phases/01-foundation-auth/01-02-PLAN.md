---
phase: 01-foundation-auth
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/(dashboard)/layout.tsx
  - src/app/(dashboard)/today/page.tsx
  - src/app/(dashboard)/history/page.tsx
  - src/app/globals.css
  - src/app/manifest.ts
  - src/components/layout/BottomNav.tsx
  - src/components/layout/Header.tsx
  - src/components/layout/SyncStatus.tsx
  - src/components/offline/OfflineBanner.tsx
  - src/hooks/useOnlineStatus.ts
  - src/hooks/useSupabaseRealtime.ts
  - src/hooks/useSyncStatus.ts
  - src/app/api/health/route.ts
  - public/icons/icon-192x192.png
  - public/icons/icon-512x512.png
autonomous: false
must_haves:
  truths:
    - "App shell renders with bottom navigation showing Today and History tabs"
    - "Active tab is visually highlighted in the bottom nav"
    - "Header shows user identity (name) and sync status indicator"
    - "Sync status shows 'Synced' when online and connected"
    - "Sync status shows 'Offline' when network is disconnected"
    - "Offline banner appears when user goes offline, disabling action buttons"
    - "When offline banner shows, user can still view (read) the current page content"
    - "Real-time changes from Supabase appear without page refresh"
    - "Visual design is warm, soft, rounded -- not clinical (Headspace/Calm feel)"
    - "Bottom nav is thumb-friendly on mobile (large tap targets, safe area padding)"
  artifacts:
    - path: "src/components/layout/BottomNav.tsx"
      provides: "2-tab bottom navigation (Today, History)"
      contains: "Today"
    - path: "src/components/layout/Header.tsx"
      provides: "App header with user name and sync status"
      contains: "SyncStatus"
    - path: "src/components/layout/SyncStatus.tsx"
      provides: "Sync status indicator component"
      contains: "Synced"
    - path: "src/components/offline/OfflineBanner.tsx"
      provides: "Offline mode banner disabling mutations"
      contains: "offline"
    - path: "src/hooks/useOnlineStatus.ts"
      provides: "Hook for detecting online/offline state"
      exports: ["useOnlineStatus"]
    - path: "src/hooks/useSupabaseRealtime.ts"
      provides: "Hook for Supabase real-time subscriptions"
      exports: ["useSupabaseRealtime"]
    - path: "src/hooks/useSyncStatus.ts"
      provides: "Hook for sync status state management"
      exports: ["useSyncStatus"]
    - path: "src/app/manifest.ts"
      provides: "PWA manifest for mobile install"
      contains: "standalone"
  key_links:
    - from: "src/app/(dashboard)/layout.tsx"
      to: "src/components/layout/BottomNav.tsx"
      via: "import and render"
      pattern: "BottomNav"
    - from: "src/app/(dashboard)/layout.tsx"
      to: "src/components/layout/Header.tsx"
      via: "import and render"
      pattern: "Header"
    - from: "src/components/layout/Header.tsx"
      to: "src/components/layout/SyncStatus.tsx"
      via: "import and render"
      pattern: "SyncStatus"
    - from: "src/components/layout/SyncStatus.tsx"
      to: "src/hooks/useSyncStatus.ts"
      via: "hook consumption"
      pattern: "useSyncStatus"
    - from: "src/hooks/useSyncStatus.ts"
      to: "src/hooks/useOnlineStatus.ts"
      via: "online detection for sync state"
      pattern: "useOnlineStatus"
    - from: "src/hooks/useSupabaseRealtime.ts"
      to: "src/lib/supabase/client.ts"
      via: "creates Supabase channel subscriptions"
      pattern: "supabase.*channel"
---

<objective>
Build the mobile-first app shell with warm visual design, bottom navigation (Today/History tabs), real-time Supabase subscriptions, online/offline detection, and sync status indicator. This transforms the auth skeleton from Plan 01 into a polished, usable shell ready for Phase 2 content.

Purpose: The app shell is what Harris and Kent see every time they open the app. It must feel warm and calming (not clinical), work on iPhones, show sync status, and gracefully handle offline scenarios. Real-time hooks built here will be reused by every feature in Phases 2-4.

Output: A complete mobile-first app shell with warm Headspace/Calm aesthetic, working real-time infrastructure, and offline-aware UI.
</objective>

<execution_context>
@/Users/harriswatkins/.claude/get-shit-done/workflows/execute-plan.md
@/Users/harriswatkins/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-auth/01-RESEARCH.md
@.planning/phases/01-foundation-auth/01-CONTEXT.md
@.planning/phases/01-foundation-auth/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mobile-first app shell with warm visual design and bottom navigation</name>
  <files>
    src/app/(dashboard)/layout.tsx
    src/app/(dashboard)/today/page.tsx
    src/app/(dashboard)/history/page.tsx
    src/app/globals.css
    src/app/manifest.ts
    src/components/layout/BottomNav.tsx
    src/components/layout/Header.tsx
    public/icons/icon-192x192.png
    public/icons/icon-512x512.png
  </files>
  <action>
    1. Update `src/app/globals.css` to establish the warm, soft visual design system:
       - Define CSS custom properties for the warm color palette:
         - Primary: soft emerald/sage greens (--primary: oklch(0.7 0.15 160))
         - Accent: soft lavender/purple (--accent: oklch(0.7 0.12 290))
         - Background: warm off-white (--background: oklch(0.98 0.005 90))
         - Surface/card: warm white (--card: oklch(0.99 0.003 90))
         - Text: warm dark (not pure black -- oklch(0.25 0.02 60))
         - Muted text: warm gray
         - Border: very soft warm gray
         - Destructive: soft warm red for errors
       - Set base font to system-ui with -apple-system fallback for iOS
       - Set border-radius CSS variable to 12px for the soft/rounded feel
       - Add safe-area padding support: `env(safe-area-inset-bottom)` for bottom nav
       - Ensure all shadcn CSS variables (--primary, --secondary, --background, etc.) map to warm palette
       - Make sure Tailwind v4 and shadcn are both happy (check if Tailwind v4 uses CSS-first config or if project uses v3)

    2. Create `src/components/layout/BottomNav.tsx` (client component):
       - 2 tabs ONLY: Today (calendar/sun icon) and History (clock/list icon)
       - Use lucide-react icons (Calendar, Clock or History)
       - Active tab: primary green color with subtle background highlight
       - Inactive tab: muted warm gray
       - Fixed to bottom of viewport
       - Height: 64px minimum (thumb-friendly)
       - Add `pb-safe` padding for iPhone home indicator area using `env(safe-area-inset-bottom)`
       - Rounded top corners on the nav bar itself for soft feel
       - Subtle top border or shadow for visual separation
       - Use `usePathname()` from next/navigation to determine active tab
       - Each tab is a Next.js Link component

    3. Create `src/components/layout/Header.tsx` (client component):
       - Shows app context: user's display name (e.g., "Harris" or "Kent")
       - Subtle, not dominating -- warm soft background
       - Fixed to top of viewport
       - Include a slot/area for the SyncStatus component (built in Task 2)
       - Height: ~56px
       - Rounded bottom corners for soft feel
       - Safe area padding top for iPhone notch: `env(safe-area-inset-top)`

    4. Update `src/app/(dashboard)/layout.tsx`:
       - Server component that checks auth (keep from Plan 01)
       - Fetch user profile from Supabase profiles table to get display_name
       - Pass display_name to a client wrapper component that renders Header + BottomNav + children
       - Add proper padding: top padding for header, bottom padding for nav
       - Content area should scroll independently (not the whole page)
       - Structure: Header (fixed top) -> Scrollable content area -> BottomNav (fixed bottom)

    5. Update `src/app/(dashboard)/today/page.tsx`:
       - Placeholder content styled with warm design
       - Show: "Good [morning/afternoon/evening], [Name]" based on time of day
       - Show: "Today's schedule will appear here in Phase 2" with a subtle empty state
       - Use a calming illustration placeholder or soft icon
       - Pad content to avoid header/nav overlap

    6. Update `src/app/(dashboard)/history/page.tsx`:
       - Placeholder: "History will appear here in Phase 2"
       - Consistent styling with Today page

    7. Create `src/app/manifest.ts` for PWA support:
       - name: "Medical Dashboard"
       - short_name: "MedDash"
       - start_url: "/today"
       - display: "standalone"
       - background_color and theme_color matching warm palette
       - Icons: generate simple placeholder icons (192x192 and 512x512) using a simple SVG-to-PNG or just create minimal placeholder PNGs with a green circle and "M" letter. Use a simple approach -- create SVG files or use a canvas script.
  </action>
  <verify>
    1. `npm run dev` -- app loads with warm color palette (no harsh whites or blacks)
    2. Bottom nav shows exactly 2 tabs: Today and History
    3. Tapping Today navigates to /today, History to /history
    4. Active tab is visually distinct (green highlight)
    5. Header shows user name
    6. On mobile viewport (Chrome DevTools responsive mode, iPhone 14), bottom nav is thumb-reachable
    7. Content scrolls between fixed header and bottom nav
    8. `npx tsc --noEmit` passes
  </verify>
  <done>
    App shell has warm Headspace/Calm visual design with soft greens and purples. Bottom navigation shows Today and History tabs with proper active states. Header displays user name. Layout is mobile-first with safe area support. PWA manifest is configured.
  </done>
</task>

<task type="auto">
  <name>Task 2: Real-time subscriptions, online/offline detection, and sync status</name>
  <files>
    src/hooks/useOnlineStatus.ts
    src/hooks/useSupabaseRealtime.ts
    src/hooks/useSyncStatus.ts
    src/components/layout/SyncStatus.tsx
    src/components/offline/OfflineBanner.tsx
    src/app/api/health/route.ts
  </files>
  <action>
    1. Create `src/app/api/health/route.ts`:
       - Simple GET handler that returns `{ status: 'ok' }` with 200
       - Used by periodic connectivity checks
       - Minimal -- no auth, no database, just responds

    2. Create `src/hooks/useOnlineStatus.ts`:
       - Returns `isOnline: boolean`
       - Initialize with `navigator.onLine` (wrapped in typeof check for SSR safety)
       - Listen to window `online` and `offline` events
       - Periodic connectivity check every 30 seconds: HEAD request to `/api/health`
       - On fetch success: online. On fetch error/timeout: offline.
       - Cleanup: remove event listeners and clear interval on unmount
       - Add 3-second timeout to fetch to avoid hanging

    3. Create `src/hooks/useSyncStatus.ts`:
       - Returns `syncStatus: 'synced' | 'syncing' | 'offline'`
       - Uses `useOnlineStatus()` internally
       - When offline → 'offline'
       - When online and no pending operations → 'synced'
       - When online and operations in flight → 'syncing'
       - Expose a `setSyncing(boolean)` function for consumers to signal sync activity
       - The syncing state auto-resets to 'synced' after 2 seconds (debounce) to handle rapid updates

    4. Create `src/hooks/useSupabaseRealtime.ts`:
       - Generic hook: `useSupabaseRealtime<T>(table: string, options?: { filter?: string, onInsert?: (item: T) => void, onUpdate?: (item: T) => void, onDelete?: (id: string) => void })`
       - Creates Supabase channel subscription for postgres_changes on the given table
       - Listens to INSERT, UPDATE, DELETE events
       - Calls the appropriate callback when changes arrive
       - CRITICAL: Cleanup subscription in useEffect return (prevent memory leaks!)
       - Use `supabase.removeChannel(channel)` in cleanup
       - Return the channel status for debugging

    5. Create `src/components/layout/SyncStatus.tsx` (client component):
       - Uses `useSyncStatus()` hook
       - Displays a small, always-visible indicator in the header area:
         - "Synced" → small green dot + "Synced" text (subtle, not attention-grabbing)
         - "Syncing..." → animated pulsing dot (soft amber/yellow) + "Syncing..." text
         - "Offline" → red/orange dot + "Offline" text
       - Small font size (text-xs), doesn't dominate the header
       - Smooth transitions between states (CSS transition on color/opacity)

    6. Create `src/components/offline/OfflineBanner.tsx` (client component):
       - Uses `useOnlineStatus()` hook
       - When offline: shows a warm amber/orange banner at the top of the content area (below header)
       - Message: "You're offline. You can view the dashboard but actions are paused until you reconnect."
       - Warm styling: rounded corners, soft amber background, warm text color
       - Smooth slide-in/slide-out animation (CSS transition)
       - When online: renders nothing (return null)

    7. Wire OfflineBanner into the dashboard layout:
       - Add OfflineBanner to `src/app/(dashboard)/layout.tsx` client wrapper, positioned below the header and above the main content area
  </action>
  <verify>
    1. `npm run dev` -- app loads with sync status showing "Synced" (green dot) in header
    2. Open Chrome DevTools -> Network -> set to "Offline" mode -> sync status changes to "Offline" (within 30 seconds or immediately via browser event)
    3. Offline banner appears with warm amber styling
    4. Set back to "Online" -> sync status returns to "Synced", banner disappears
    5. Open two browser tabs logged in as the same user. In Supabase SQL Editor, insert a row into profiles. Both tabs should react (real-time hook is connected, even if UI doesn't display it yet -- verify via console.log in the hook).
    6. `npx tsc --noEmit` passes
  </verify>
  <done>
    Sync status indicator shows "Synced" / "Syncing..." / "Offline" in the header. Offline banner appears when network is lost with warm amber styling. Real-time subscription hook is working and properly cleans up. Online status detection combines browser events with periodic health checks. All hooks export cleanly for reuse in Phase 2+.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete Phase 1 experience on mobile</name>
  <files>none (verification only)</files>
  <action>
    No code changes. Human verifies the complete Phase 1 experience on a real mobile device or Chrome DevTools mobile emulation.
  </action>
  <what-built>
    Complete Phase 1: Auth flow (magic link), mobile-first app shell with warm Headspace/Calm design, bottom navigation (Today/History), sync status indicator, and offline detection.
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000 on your phone (or Chrome DevTools mobile mode, iPhone 14 preset)
    2. You should see the login page with a warm, inviting design
    3. Enter harriswatk@gmail.com -> should show "Check your email" confirmation
    4. Check email, click magic link -> should redirect to /today
    5. Verify the app shell:
       - Header shows "Harris" and a green "Synced" indicator
       - Bottom nav shows "Today" and "History" tabs
       - Today tab shows a warm greeting ("Good morning/afternoon/evening, Harris")
       - Tapping History switches to History tab
       - Bottom nav is comfortably thumb-reachable
    6. Test offline: put phone in airplane mode (or use DevTools offline)
       - Sync status should change to "Offline"
       - Amber offline banner should appear
       - You should still be able to view the page (read-only)
    7. Go back online: sync status returns to "Synced", banner disappears
    8. Close the browser completely, reopen, go to the URL -> should still be logged in (persistent session)
    9. Overall visual check: Does it feel warm and calming? Soft greens/purples, rounded corners, not clinical?
  </how-to-verify>
  <resume-signal>Type "approved" if everything looks good, or describe any issues you see</resume-signal>
  <verify>User confirms visual design, navigation, auth flow, sync status, and offline behavior all work correctly on mobile.</verify>
  <done>User has approved the Phase 1 experience -- warm design, auth, navigation, sync status, and offline all verified on mobile.</done>
</task>

</tasks>

<verification>
1. App shell renders with warm, soft visual design (Headspace/Calm vibes)
2. Bottom navigation has exactly 2 tabs: Today and History
3. Active tab is highlighted with primary green color
4. Header shows user display name and sync status
5. Sync status accurately reflects: Synced (online), Syncing (in-flight), Offline (disconnected)
6. Offline banner appears when offline with warm amber styling
7. User can still view content when offline (read-only mode)
8. Real-time subscription hook works (verified via console or profile updates)
9. All tap targets are thumb-friendly on mobile
10. PWA manifest is configured for standalone mode
</verification>

<success_criteria>
- Mobile-first app shell with warm, soft design (not clinical)
- Bottom navigation: Today and History tabs, thumb-friendly
- Header: user name + sync status indicator
- Sync status: "Synced" / "Syncing..." / "Offline" always visible
- Offline banner appears when disconnected, content still viewable
- Real-time hook subscribes to Supabase changes and cleans up properly
- Online detection uses browser events + periodic health checks
- PWA manifest enables standalone mobile experience
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-auth/01-02-SUMMARY.md`
</output>
